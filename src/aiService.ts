import { Message } from "./types";

/**
 * AI Service for the tutor demo
 * 
 * SECURITY NOTE: This service uses demo responses only.
 * For real AI functionality, users must authenticate and use 
 * the backend API at /api/ai/chat which properly secures the API key.
 * 
 * The Anthropic API key is stored server-side only and never exposed to the browser.
 */

// Demo responses for the landing page experience
const DEMO_RESPONSES: Record<string, string[]> = {
  '–ê–ª–≥–µ–±—Ä–∞': [
    '–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å –ø–æ –∞–ª–≥–µ–±—Ä–µ! –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º —ç—Ç–æ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ—à–∞–≥–æ–≤–æ. –ß—Ç–æ –Ω–∞–º –¥–∞–Ω–æ –≤ —É—Å–ª–æ–≤–∏–∏? ‚ûï',
    '–•–æ—Ä–æ—à–æ! –î–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –ø—Ä–∏–º–µ–Ω–∏–º –∞–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è. –° —á–µ–≥–æ –Ω–∞—á–Ω—ë–º?',
    '–î–∞–≤–∞–π –ø–æ–¥—É–º–∞–µ–º! –ö–∞–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ —Å—Ç–µ–ø–µ–Ω–µ–π –∏–ª–∏ –∫–æ—Ä–Ω–µ–π –∑–¥–µ—Å—å –ø—Ä–∏–º–µ–Ω–∏–º—ã? –ü–æ–ø—Ä–æ–±—É–π –≤—Å–ø–æ–º–Ω–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É. ü§î'
  ],
  '–ì–µ–æ–º–µ—Ç—Ä–∏—è': [
    '–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å –ø–æ –≥–µ–æ–º–µ—Ç—Ä–∏–∏! –î–∞–≤–∞–π –ø–æ—Å—Ç—Ä–æ–∏–º —á–µ—Ä—Ç—ë–∂ –≤ —É–º–µ. –ö–∞–∫–∏–µ —Ñ–∏–≥—É—Ä—ã —É –Ω–∞—Å –µ—Å—Ç—å? üìê',
    '–•–æ—Ä–æ—à–æ! –ö–∞–∫–∏–µ —Ç–µ–æ—Ä–µ–º—ã –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å? –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —É–≥–ª—ã.',
    '–î–ª—è —Ä–µ—à–µ–Ω–∏—è –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–æ—Ä–µ–º—É –ü–∏—Ñ–∞–≥–æ—Ä–∞ –∏–ª–∏ –ø–æ–¥–æ–±–∏–µ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤. –ß—Ç–æ –ø–æ–¥—Ö–æ–¥–∏—Ç? üî∫'
  ],
  '–†—É—Å—Å–∫–∏–π': [
    '–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! –≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –ª–µ–≥–∫–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å. –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö. üìñ',
    '–û—Ç–ª–∏—á–Ω–æ! –í—Å–ø–æ–º–Ω–∏–º –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞. –ö–∞–∫–∏–µ —Å–ª–æ–≤–∞ —Ç—ã –∑–Ω–∞–µ—à—å?',
    '–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –≠—Ç—É —Ç–µ–º—É –ª–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å, –µ—Å–ª–∏ –∑–∞–ø–æ–º–Ω–∏—Ç—å –æ–¥–∏–Ω —Å–µ–∫—Ä–µ—Ç... üí°'
  ],
  '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π': [
    'Great question! Let me explain this in a simple way. –ö–∞–∫–æ–π —ç—Ç–æ time? üá¨üáß',
    'Good! –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –Ω–∞ –ø—Ä–∏–º–µ—Ä–∞—Ö. What do you think?',
    'Excellent! This is an important topic. Let\'s practice together! Try to make a sentence.'
  ],
  '–§–∏–∑–∏–∫–∞': [
    '–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å –ø–æ —Ñ–∏–∑–∏–∫–µ! –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º —ç—Ç–æ —è–≤–ª–µ–Ω–∏–µ. –ö–∞–∫–∏–µ —Å–∏–ª—ã –¥–µ–π—Å—Ç–≤—É—é—Ç? ‚ö°',
    '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –ö–∞–∫–∏–µ –∑–∞–∫–æ–Ω—ã —Ñ–∏–∑–∏–∫–∏ –∑–¥–µ—Å—å –ø—Ä–∏–º–µ–Ω–∏–º—ã? –ü–æ–¥—Å–∫–∞–∑–∫–∞: –∑–∞–∫–æ–Ω—ã –ù—å—é—Ç–æ–Ω–∞.',
    '–î–∞–≤–∞–π –ø–æ–¥—É–º–∞–µ–º, –∫–∞–∫–∏–µ –≤–µ–ª–∏—á–∏–Ω—ã –Ω–∞–º –∏–∑–≤–µ—Å—Ç–Ω—ã? –°–æ—Å—Ç–∞–≤–∏–º —É—Ä–∞–≤–Ω–µ–Ω–∏–µ! üî¨'
  ],
  '–•–∏–º–∏—è': [
    '–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º —ç—Ç—É —Ä–µ–∞–∫—Ü–∏—é. –ö–∞–∫–∏–µ –≤–µ—â–µ—Å—Ç–≤–∞ –≤—Å—Ç—É–ø–∞—é—Ç? üß™',
    '–û—Ç–ª–∏—á–Ω–æ! –ö–∞–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É—á–∞—Å—Ç–≤—É—é—Ç? –î–∞–≤–∞–π —Å–æ—Å—Ç–∞–≤–∏–º —É—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–∏!',
    '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –∑–∞–¥–∞—á–∞! –í—Å–ø–æ–º–Ω–∏–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é —Ç–∞–±–ª–∏—Ü—É. –ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç?'
  ],
  '–ë–∏–æ–ª–æ–≥–∏—è': [
    '–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å –ø–æ –±–∏–æ–ª–æ–≥–∏–∏! –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è. –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –∫–ª–µ—Ç–∫–æ–π? üß¨',
    '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –ü–æ–¥—É–º–∞–π –æ —Å–≤—è–∑–∏ —Å—Ç—Ä–æ–µ–Ω–∏—è –∏ —Ñ—É–Ω–∫—Ü–∏–∏. –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?',
    '–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! –†–∞—Å—Å–º–æ—Ç—Ä–∏–º —ç—Ç–æ —è–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ. –ì–¥–µ –æ–Ω–æ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ –ø—Ä–∏—Ä–æ–¥–µ?'
  ],
  '–ò—Å—Ç–æ—Ä–∏—è': [
    '–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π –≤—Å–ø–æ–º–Ω–∏–º —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥. –ö–∞–∫–æ–π —ç—Ç–æ –±—ã–ª –≤–µ–∫? üèõÔ∏è',
    '–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! –ö–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è —ç—Ç–æ–º—É –ø—Ä–µ–¥—à–µ—Å—Ç–≤–æ–≤–∞–ª–∏? –ü–æ–¥—É–º–∞–π –æ –ø—Ä–∏—á–∏–Ω–∞—Ö.',
    '–û—Ç–ª–∏—á–Ω–æ! –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ —ç—Ç–æ –≤—Ä–µ–º—è?'
  ],
  '–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞': [
    '–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —ç—Ç–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ. –ö—Ç–æ –≥–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π? üìö',
    '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –ß—Ç–æ –∞–≤—Ç–æ—Ä —Ö–æ—Ç–µ–ª —Å–∫–∞–∑–∞—Ç—å —ç—Ç–∏–º –æ–±—Ä–∞–∑–æ–º? –ü–æ–¥—É–º–∞–π –æ —Å–∏–º–≤–æ–ª–∏–∫–µ.',
    '–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è. –í —á—ë–º –µ–≥–æ —Å—É—Ç—å?'
  ],
  '–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π': [
    'Tr√®s bien! –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ. Comment dit-on...? üá´üá∑',
    'Bon! –ü–æ–ø—Ä–æ–±—É–µ–º –Ω–∞ –ø—Ä–∏–º–µ—Ä–∞—Ö. Essaie de faire une phrase!',
    'Excellent! –≠—Ç–æ –≤–∞–∂–Ω–∞—è —Ç–µ–º–∞ –≤ –≥—Ä–∞–º–º–∞—Ç–∏–∫–µ. –ö–∞–∫–æ–π –∞—Ä—Ç–∏–∫–ª—å –∑–¥–µ—Å—å –Ω—É–∂–µ–Ω?'
  ]
};

const DEFAULT_RESPONSES = [
  '–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è –≤–º–µ—Å—Ç–µ. –° —á–µ–≥–æ –Ω–∞—á–Ω—ë–º? üòä',
  '–•–æ—Ä–æ—à–æ! –≠—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Ç–µ–º–∞. –ù–∞—á–Ω—ë–º —Å –æ—Å–Ω–æ–≤. –ß—Ç–æ —Ç—ã —É–∂–µ –∑–Ω–∞–µ—à—å?',
  '–ü–æ–Ω—è–ª! –°–µ–π—á–∞—Å –æ–±—ä—è—Å–Ω—é –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º. –ì–æ—Ç–æ–≤? ‚ú®'
];

/**
 * Get a tutor response for the demo
 * In demo mode, returns pre-written responses that simulate the tutor style
 */
export const getTutorResponse = async (
  history: Message[], 
  subject?: string
): Promise<string> => {
  // Simulate a small delay for realistic UX
  await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 700));
  
  const responses = subject && DEMO_RESPONSES[subject] 
    ? DEMO_RESPONSES[subject] 
    : DEFAULT_RESPONSES;
  
  // Use the message length to pick a response (for variety based on input)
  const lastMessage = history[history.length - 1];
  const messageLength = lastMessage?.text?.length || 0;
  const responseIndex = messageLength % responses.length;
  
  const response = responses[responseIndex];
  
  return response + '\n\n_üí° –≠—Ç–æ –¥–µ–º–æ-–≤–µ—Ä—Å–∏—è. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç AI-—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞!_';
};

/**
 * Check if the full AI service is available
 * (Requires authenticated session and backend connection)
 */
export const isAIServiceAvailable = (): boolean => {
  // In demo mode, full AI is not available
  // Users need to sign up and use the authenticated backend API
  return false;
};
